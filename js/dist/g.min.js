const t=console.log,e=Array.isArray,i=t=>null==t,r=(t,e)=>e(t)?t:t.children?t.children.find(t=>r(t,e)):void 0;function n(t){return!0===(t=>null!=t&&"object"==typeof t&&!1===Array.isArray(t))(t)&&"[object Object]"===Object.prototype.toString.call(t)}const h=(t,e,i,s)=>{let r,n=t[i];if(n!==e){if(n&&(r=n[s])){let e=r.findIndex(e=>e===t);e>-1&&r.splice(e,1)}e&&(r=e[s],r||(r=e[s]=[]),r.findIndex(e=>e===t)<0&&r.push(t)),t[i]=e}},a=t=>{let e,i;return!1!==n(t)&&(e=t.constructor,"function"==typeof e&&(i=e.prototype,!1!==n(i)&&!1!==i.hasOwnProperty("isPrototypeOf")))},l=(t,e,i)=>{if(t===t+""){if("<"!==(t=t.trim())[0])return[i?document.createElementNS(i,t):document.createElement(t)];if("text/html"===e){let e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,Array.from(e.body.children)}{let i=((t,e)=>("image/svg+xml"===e&&(t=`<svg xmlns="http://www.w3.org/2000/svg"  xmlns:xlink="http://www.w3.org/1999/xlink">${t}</svg>`),(new DOMParser).parseFromString(t,e).documentElement))(t,e);return i.childNodes.length>1?Array.from(i.childNodes):[i.firstChild]}}},o=t=>l(t,"image/svg+xml","http://www.w3.org/2000/svg"),d=t=>i(t)||(t=>t===t+""&&""===t.trim())(t),c=(t,e)=>t&&t===t+""?t.trim().split(e||/[,\s]+/g):[],u=function(...t){let i="boolean"==typeof t[0],s=1,r=t[0];i&&(s=2,i=t[0],r=t[1]),r=r||{};for(let n=s;n<t.length;n++){let s=t[n];for(let t in s){let n,h=r[t],l=s[t];if(void 0===l||h===l)continue;let o=e(l),d=a(l);i&&(o||d)?(n=o?h||[]:h||{},r[t]=u(i,n,l)):r[t]=l}}return r},g=/\r\n|\n/g,{abs:x,sqrt:m,pow:y,round:f,PI:w}=Math,p=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],b=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],v=Math.log2||(t=>Math.log(t)*Math.LOG2E),E=(t,e,i)=>t<e?e:t>i?i:t,C=(t,e,i)=>{function s(t){let e=134217729*t,i=t-e+e;return[i,t-i]}let r=e*e-t*i,n=e*e+t*i;if(3*x(r)<n){let n=s(t),h=s(e),a=s(i),l=e*e,o=t*i;r=l-o+(h[0]*h[0]-l+2*h[0]*h[1]+h[1]*h[1]-(n[0]*a[0]-o+n[0]*a[1]+n[1]*a[0]+n[1]*a[1]))}return r};function N(){let t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?y(2,-f(v(t))):0}const M={toPair:(t,e)=>`${t},${e}`,EPSILON:1e-11,MACHINE_EPSILON:112e-18,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(m(2)-1)/3,TOLERANCE:1e-5,deg:t=>f(180*t/w%360*1e3)/1e3,rad:t=>t%360*w/180,isZero:t=>t>=-1e-11&&t<=1e-11,clamp:E,integrate(t,e,i,s){let r=p[s-2],n=b[s-2],h=.5*(i-e),a=h+e,l=0,o=s+1>>1,d=1&s?n[l++]*t(a):0;for(;l<o;){let e=h*r[l];d+=n[l++]*(t(a+e)+t(a-e))}return h*d},findRoot(t,e,i,s,r,n,h){for(let a=0;a<n;a++){let n=t(i),a=n/e(i),l=i-a;if(x(a)<h){i=l;break}n>0?(r=i,i=l<=s?.5*(s+r):l):(s=i,i=l>=r?.5*(s+r):l)}return E(i,s,r)},solveQuadratic(t,e,i,s,r,n){let h,a=1/0;if(x(t)<1e-11){if(x(e)<1e-11)return x(i)<1e-11?-1:0;h=-i/e}else{let s=C(t,e*=-.5,i);if(s&&x(s)<112e-18){let r=N(x(t),x(e),x(i));r&&(s=C(t*=r,e*=r,i*=r))}if(s>=-112e-18){let r=s<0?0:m(s),n=e+(e<0?-r:r);0===n?(h=i/t,a=-h):(h=n/t,a=i/n)}}let l=0,o=null==r,d=r-1e-11,c=n+1e-11;return isFinite(h)&&(o||h>d&&h<c)&&(s[l++]=o?h:E(h,r,n)),a!==h&&isFinite(a)&&(o||a>d&&a<c)&&(s[l++]=o?a:E(a,r,n)),l},solveCubic(t,e,i,s,r,n,h){let a,l,o,d,c,u=N(x(t),x(e),x(i),x(s));function g(r){a=r;let n=t*a;l=n+e,o=l*a+i,d=(n+l)*a+o,c=o*a+s}if(u&&(t*=u,e*=u,i*=u,s*=u),x(t)<1e-11)t=e,l=i,o=s,a=1/0;else if(x(s)<1e-11)l=e,o=i,a=0;else{g(-e/t/3);let r=c/t,n=y(x(r),1/3),h=r<0?-1:1,u=-d/t,f=u>0?1.324717957244746*Math.max(n,m(u)):n,w=a-h*f;if(w!==a){do{g(w),w=0===d?a:a-c/d/(1+112e-18)}while(h*w>h*a);x(t)*a*a>x(s/a)&&(o=-s/a,l=(o-i)/a)}}let f=M.solveQuadratic(t,l,o,r,n,h),w=null==n;return isFinite(a)&&(0===f||f>0&&a!==r[0]&&a!==r[1])&&(w||a>n-1e-11&&a<h+1e-11)&&(r[f++]=w?a:E(a,n,h)),f}},{abs:I,sqrt:_,PI:O,atan2:A,acos:S}=Math,j=Object.assign,B=M.isZero,T={center:"center",start:"start",end:"end",around:"around",between:"between",evenly:"evenly"},P={horizontal:"horizontal",vertical:"vertical",down:"down",up:"up",left:"left",right:"right"},H={none:"none",fill:"fill",cover:"cover"};class k{constructor(t,e,i,s,r,n){Array.isArray(t)?(this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5],this.a=t[0]):t&&isNaN(t)?(this.b=+t.b,this.c=+t.c,this.d=+t.d,this.e=+t.e,this.f=+t.f,this.a=+t.a):arguments.length>=6?(this.a=+t,this.b=+e,this.c=+i,this.d=+s,this.e=+r,this.f=+n):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}toArray(){return[this.a,this.b,this.c,this.d,this.e,this.f]}clone(){return new k(this.a,this.b,this.c,this.d,this.e,this.f)}equals(t){return t===this||t&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===mx.f}isIdentity(){return 1===this.a&&0===this.c&&0===this.b&&1===this.d&&0===this.e&&0===this.f}orNullIfIdentity(){return this.isIdentity()?null:this}isInvertible(){return!!this.getDeterminant()}isSingular(){return!this.getDeterminant()}translate(t,e){return this.e+=t*this.a+e*this.c,this.f+=t*this.b+e*this.d,this}scale(t,e,i){return i&&this.translate(i),this.a*=t,this.b*=t,this.c*=e,this.d*=e,i&&this.translate(i.negate()),this}rotate(t,e){t*=Math.PI/180;let i=(e=e||new q).x,s=e.y,r=Math.cos(t),n=Math.sin(t),h=i-i*r+s*n,a=s-i*n-s*r,l=this.a,o=this.b,d=this.c,c=this.d;return this.a=r*l+n*d,this.b=r*o+n*c,this.c=-n*l+r*d,this.d=-n*o+r*c,this.e+=h*l+a*d,this.f+=h*o+a*c,this}shear(t,e){e&&this.translate(e);let i=this.a,s=this.b;return this.a+=t.y*this.c,this.b+=t.y*this.d,this.c+=t.x*i,this.d+=t.x*s,e&&this.translate(e.negate()),this}skew(t,e){let i=Math.PI/180,s=new q(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(s,e)}append(t){if(t){let e=this.a,i=this.b,s=this.c,r=this.d,n=t.a,h=t.c,a=t.b,l=t.d,o=t.e,d=t.f;this.a=n*e+a*s,this.c=h*e+l*s,this.b=n*i+a*r,this.d=h*i+l*r,this.e+=o*e+d*s,this.f+=o*i+d*r}return this}prepend(t){if(t){let e=this.a,i=this.b,s=this.c,r=this.d,n=this.e,h=this.f,a=t.a,l=t.c,o=t.b,d=t.d,c=t.e,u=t.f;this.a=a*e+l*i,this.c=a*s+l*r,this.b=o*e+d*i,this.d=o*s+d*r,this.e=a*n+l*h+c,this.f=o*n+d*h+u}return this}appended(t){return this.clone().append(t)}prepended(t){return this.clone().prepend(t)}decompose(){let t,e,i,s=this.a,r=this.b,n=this.c,h=this.d,a=s*h-r*n,l=Math.sqrt,o=Math.atan2,d=180/Math.PI;if(0!==s||0!==r){let d=l(s*s+r*r);t=Math.acos(s/d)*(r>0?1:-1),e=[d,a/d],i=[o(s*n+r*h,d*d),0]}else if(0!==n||0!==h){let d=l(n*n+h*h);t=Math.asin(n/d)*(h>0?1:-1),e=[a/d,d],i=[0,o(s*n+r*h,d*d)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*d,scaling:new q(e),skewing:new q(i[0]*d,i[1]*d)}}transform(t,e,i){return arguments.length<3?this.transformPoint(t):this.transformCoordinates(t,e,i)}transformPoint(t,e){let i=t.x,s=t.y;return e||(e=new q),e.set(i*this.a+s*this.c+this.e,i*this.b+s*this.d+this.f)}transformCoordinates(t,e,i){for(let s=0,r=2*i;s<r;s+=2){let i=t[s],r=t[s+1];e[s]=i*this.a+r*this.c+this.e,e[s+1]=i*this.b+r*this.d+this.f}return e}transformCorners(t){let e=t.x,i=t.y,s=e+t.width,r=i+t.height,n=[e,i,s,i,s,r,e,r];return this.transformCoordinates(n,n,4)}transformBounds(t,e){let i=this.transformCorners(t),s=i.slice(0,2),r=s.slice();for(let t=2;t<8;t++){let e=i[t],n=1&t;e<s[n]?s[n]=e:e>r[n]&&(r[n]=e)}return e||(e=new Rectangle),e.set(s[0],s[1],r[0]-s[0],r[1]-s[1])}inverseTransform(t,e){let i=this.a,s=this.b,r=this.c,n=this.d,h=this.e,a=this.f,l=i*n-s*r,o=null;if(l&&!isNaN(l)&&isFinite(h)&&isFinite(a)){let h=t.x-this.e,a=t.y-this.f;e||(e=new q),o=e.set((h*n-a*r)/l,(a*i-h*s)/l)}return o}invert(){let t=this.a,e=this.b,i=this.c,s=this.d,r=this.e,n=this.f,h=t*s-e*i,a=null;return h&&!isNaN(h)&&isFinite(r)&&isFinite(n)&&(this.a=s/h,this.b=-e/h,this.c=-i/h,this.d=t/h,this.e=(i*n-s*r)/h,this.f=(e*r-t*n)/h,a=this),a}inverted(){return this.clone().invert()}calc(t,e,i){return{x:t*this.a+e*this.c+(i?0:this.e),y:t*this.b+e*this.d+(i?0:this.f)}}getValues(){return[this.a,this.b,this.c,this.d,this.e,this.f]}toString(){return`matrix(${this.a},${this.b},${this.c},${this.d},${this.e},${this.f})`}getTranslation(){return new q(this.e,this.f)}getScaling(){return(this.decompose()||{}).scaling}getRotation(){return(this.decompose()||{}).rotation}}class L{constructor(t,e){this.width=t,this.height=e}static fromRadius(t,e){return new L(2*t,2*(e||t))}}const R=t=>{let e=parseFloat(t);return isNaN(e)?0:e};class W{constructor(t){j(this,{x:void 0,y:void 0,width:void 0,height:void 0,minWidth:void 0,minHeight:void 0,maxWidth:void 0,maxHeight:void 0,contentWidth:0,contentHeight:0,dx:0,dy:0},t)}static create(t){return new W(t)}static createInverse(t){return new W(t).inverse()}static read(t){let e={};return t&&(t.x&&(e.x=R(t.x)),t.y&&(e.y=R(t.y)),t.width&&(e.width=R(t.width)),t.height&&(e.height=R(t.height))),e}static from(t){return new W(W.read(t))}translate(t,e){this.x+=t,this.y+=e}moveTo(t,e){this.x=t,this.y=e}expand(t,e){this.width+=t,this.height+=e}toInclude(t){this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}inverse(){return this.inverseXY(),this.inverseSize(),this}inverseXY(){return[this.x,this.y]=[this.y,this.x],[this.dx,this.dy]=[this.dy,this.dx],this}inverseSize(){return[this.width,this.height]=[this.height,this.width],[this.minWidth,this.minHeight]=[this.minHeight,this.minWidth],[this.maxWidth,this.maxHeight]=[this.maxHeight,this.maxWidth],[this.contentWidth,this.contentHeight]=[this.contentHeight,this.contentWidth],this}change(t){u(this,t)}intersect(t){let e=this.x,i=this.y,s=t.x,r=t.y,n=e+this.width,h=i+this.height,a=s+t.width,l=r+t.height;return!(a<=e||l<=i||s>=n||r>=h)}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}getCenterSide(t){let e=this.getCenter(),i=t.getCenter();return{dx:i.x-e.x,dy:i.y-e.y}}getBoundsSide(t){let e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),s=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return{topLeft:{x:e,y:i},bottomRight:{x:s,y:r},w:s-e,h:r-i}}nearestSide(t){let e=t.x-this.x,i=this.x+this.width-t.x,s=t.y-this.y,r=this.y+this.height-t.y,n=e,h="left";return i<n&&(n=i,h="right"),s<n&&(n=s,h="top"),r<n&&(n=r,h="bottom"),h}}class z{constructor(t){j(this,{top:0,left:0,right:0,bottom:0},t)}static all(t,e,i){return new t({left:e,right:e,top:i||e,bottom:i||e})}inverse(){return[this.left,this.top]=[this.top,this.left],[this.bottom,this.right]=[this.right,this.bottom],this}}class D extends z{static all(t,e){return z.all(D,t,e)}static only(t){return new D(t)}static createInverse(t){return new D(t).inverse()}}class $ extends z{static all(t,e){return z.all($,t,e)}static only(t){return new $(t)}static createInverse(t){return new $(t).inverse()}}class q{constructor(...t){let e=t[0],i=t[1],s=typeof e;"number"===s?i="number"==typeof i?i:e:Array.isArray(e)?(i=e[1],e=e[0]):"object"===s&&("angle"in e&&(this.angle=e.angle),"x"in e?(i=e.y,e=e.x):"width"in e&&(i=e.height,e=e.width)),this.x=+(e||0),this.y=+(i||0)}get length(){return _(this.x*this.x+this.y*this.y)}set length(t){if(this.isZero()){let e=this.angle||0;this.set(cos(e)*t,sin(e)*t)}else{let e=t/this.length;B(e)&&this.getAngle(),this.set(this.x*e,this.y*e)}}get quadrant(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}distance(t,e){return _(this.squaredDistance(t,e))}squaredDistance(t,e){let i=new q(t,e),s=i.x-this.x,r=i.y-this.y;return s*s+r*r}normalize(t){t=t||1;let e=this.length,i=0!==e?t/e:0,s=new q(this.x*i,this.y*i);return i>=0&&(s.angle=this.angle),s}rotate(t,e){if(0===t)return this.clone();t=t*O/180;let i=e?this.subtract(e):this,s=sin(t),r=cos(t);return i=new q(i.x*r-i.y*s,i.x*s+i.y*r),e?i.add(e):i}isInside(t){return t.contains(this)}isNaN(){return isNaN(this.x)||isNaN(this.y)}isZero(){return B(this.x)&&B(this.y)}isClose(t,e){return this.distance(t)<(e||TOLERANCE)}isCollinear(t,e){let i=new q(t,e);return q.isCollinear(this.x,this.y,i.x,i.y)}isOrthogonal(t,e){let i=new q(t,e);return q.isOrthogonal(this.x,this.y,i.x,i.y)}add(t,e){let i=new q(t,e);return new q(this.x+i.x,this.y+i.y)}sub(t,e){let i=new q(t,e);return new q(this.x-i.x,this.y-i.y)}mul(t,e){let i=new q(t,e);return new q(this.x*i.x,this.y*i.y)}div(t,e){let i=new q(t,e);return new q(this.x/i.x,this.y/i.y)}mod(t,e){let i=new q(t,e);return new q(this.x%i.x,this.y%i.y)}neg(){return new q(-this.x,-this.y)}clone(){return new q(this.x,this.y)}equals(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1}dot(t,e){let i=new q(t,e);return this.x*i.x+this.y*i.y}cross(t,e){let i=new q(t,e);return i.y*this.x*-i.x*this.y}getAngle(t,e){return 180*this.getAngleInRadians(t,e)/O}project(t,e){let i=new q(t,e),s=i.isZero()?0:this.dot(i)/i.dot(i);return new q(i.x*s,i.y*s)}setAngle(t){this.setAngleInRadians(t*O/180)}getDirectedAngle(t,e){let i=new q(t,e);return 180*A(this.cross(i),this.dot(i))/O}getAngleInRadians(t,e){let i=new q(t,e),s=this.angle;if(arguments.length){let t=this.length*i.length;if(B(t))return NaN;{let e=this.dot(i)/t;return S(e<-1?-1:e>1?1:e)}}return this.isZero()?s||0:A(this.y,this.x)}setAngleInRadians(t){let e=this.length;this.angle=t,this.isZero()||this.set(cos(t)*e,sin(t)*e)}transform(t){return t?t.transformPoint(this):this}toString(){return`x:${this.x}, y:${this.y}`}rotate(){return`${this.x},${this.y}`}static min(t,e){return new q(min(t.x,e.x),min(t.y,e.y))}static max(t,e){return new q(max(t.x,e.x),max(t.y,e.y))}static random(){return new q(random(),random())}static isCollinear(t,e,i,s){return I(t*s-e*i)<=_((t*t+e*e)*(i*i+s*s))*TRIGONOMETRIC_EPSILON}static isOrthogonal(t,e,i,s){return I(t*i+e*s)<=_((t*t+e*e)*(i*i+s*s))*TRIGONOMETRIC_EPSILON}}const F=t=>class extends t{constructor(t){super(t),j(this,{x1:0,y1:0,x2:0,y2:0},t)}static fromBounds(t){return{x1:t.x,y1:t.y,x2:isNaN(t.x)||isNaN(t.width)?void 0:t.x+t.width,y2:isNaN(t.y)||isNaN(t.height)?void 0:t.y+t.height}}};class V extends(F(Object)){get vx(){return this.x2-this.x1}get vy(){return this.y2-this.y1}get point(){return new q(this.x1,this.y1)}get vector(){return new q(this.vx,this.vy)}get length(){return this.vector.length}getSide(t,e){return V.getSide(this,t.x,t.y,e)}intersect(t,e){return V.intersect(this,t,e)}static intersect(t,e,i){let s=t.x1,r=t.y1,n=e.x1,h=e.y1,a=t.vx,l=t.vy,o=e.vx,d=e.vy,c=a*d-l*o;if(!M.isZero(c)){let t=s-n,e=r-h,u=(o*e-d*t)/c,g=(a*e-l*t)/c,x=-M.EPSILON,m=1+M.EPSILON;if(i||x<u&&u<m&&x<g&&g<m)return i||(u=u<=0?0:u>=1?1:u),new q(s+u*a,r+u*l)}}static intersectBounds(t,e){let{x:i,y:s,width:r,height:n}=e,h=[new V({x1:i,y1:s,x2:i+r,y2:s}),new V({x1:i+r,y1:s,x2:i+r,y2:s+n}),new V({x1:i,y1:s+n,x2:i+r,y2:s+n}),new V({x1:i,y1:s,x2:i,y2:s+n})],a=[];return h.forEach(e=>{let i=V.intersect(e,t);i&&a.push(i)}),a}static getSide(t,e,i,s){let r=t.vx,n=t.vy,h=e-t.x1,a=h*n-(i-t.y1)*r;return!s&&M.isZero(a)&&(a=(h*r+h*r)/(r*r+n*n),a>=0&&a<=1&&(a=0)),a<0?-1:a>0?1:0}static getSignedDistance(t,e,i){let s=t.x1,r=t.y1,n=t.vx,h=t.vy;return 0===n?h>0?e-s:s-e:0===h?n<0?i-r:r-i:((e-s)*h-(i-r)*n)/Math.sqrt(n*n+h*h)}static getDistance(t,e,i){return Math.abs(Line.getSignedDistance(t,e,i))}}const G=/([astvzqmhlcr])([^astvzqmhlcr]*)/gi,Z=/-?[.0-9]+(?:e[-+]?\d+)?/gi,J={a:7,c:6,h:1,l:2,m:2,q:4,r:4,s:4,t:2,v:1,z:0};class U{constructor(t){j(this,{type:null,valuse:[],absType:null,absValues:[],handleIn:null,handleOut:null,point:null},t)}}const X=t=>{let e=[];return t.replace(G,(function(t,i,s){let r=i.toLowerCase(),n=J[r];for(s=(t=>(t=t.match(Z))?t.map(Number):[])(s),"m"===r&&s.length>2&&(e.push({type:i,values:s.splice(0,2)}),r="l",i="m"===i?"l":"L");;){if(s.length<n)throw new Error("malformed path data");if(e.push({type:i,values:s.splice(0,n)}),s.length<=0)break}})),e};var Y=Math.PI/180;class Q{constructor(t){t&&this.setData(t)}setData(t){return Q.setData(this,t),this}getData(){return this.parts}matrix(e){let i=null==e||e.isIdentity(),r=[];return this.parts.forEach((t,n)=>{let h,a,l=t.type,o=t.values.slice(0),d=l.toLowerCase(),c=d===l;if(i)r.push({type:l,values:o});else switch(d){case"m":1===r.length&&(r=[]),c=n>0&&c,h=e.calc(o[0],o[1],c),r.push({type:l,values:[h.x,h.y]});break;case"h":h=e.calc(o[0],0,c),r.push({type:l,values:[h.x]});break;case"v":h=e.calc(0,o[0],c),r.push({type:l,values:[h.y]});break;case"a":let t=e.toArray(),i=this.ellipseMatrix(o[0],o[1],o[2],t);t[0]*t[3]-t[1]*t[2]<0&&(o[4]=o[4]?"0":"1"),h=e.calc(o[5],o[6],"a"===l),"A"===l&&0===o[5]&&0===o[6]||"a"===l&&0===s[5]&&0===o[6]||this.isDegenerate(i.rx,i.ry)?(l="a"===l?"l":"L",a=[h.x,h.y]):a=[i.rx,i.ry,i.ax,o[3],o[4],h.x,h.y],r.push({type:l,values:a});break;default:let d=[];for(let t=0;t<o.length;t+=2)h=e.calc(o[t],o[t+1],c),d.push(h.x,h.y);r.push({type:l,values:d})}}),t(r),r}ellipseMatrix(t,e,i,s){let r=Math.cos(i*Y),n=Math.sin(i*Y),h=[t*(s[0]*r+s[2]*n),t*(s[1]*r+s[3]*n),e*(-s[0]*n+s[2]*r),e*(-s[1]*n+s[3]*r)],a=h[0]*h[0]+h[2]*h[2],l=h[1]*h[1]+h[3]*h[3],o=((h[0]-h[3])*(h[0]-h[3])+(h[2]+h[1])*(h[2]+h[1]))*((h[0]+h[3])*(h[0]+h[3])+(h[2]-h[1])*(h[2]-h[1])),d=(a+l)/2;if(o<1e-10*d)t=e=Math.sqrt(d),i=0;else{let s=h[0]*h[1]+h[2]*h[3];o=Math.sqrt(o);let r=d+o/2,n=d-o/2;(i=Math.abs(s)<1e-10&&Math.abs(r-l)<1e-10?90:180*Math.atan(Math.abs(s)>Math.abs(r-l)?(r-a)/s:s/(r-l))/Math.PI)>=0?(t=Math.sqrt(r),e=Math.sqrt(n)):(i+=90,t=Math.sqrt(n),e=Math.sqrt(r))}return{rx:t,ry:e,ax:i}}isDegenerate(t,e){return t<1e-10*e||e<1e-10*t}abs(){}toString(){let e="";return this.parts.forEach((t,i)=>{e=e.concat(i>0?" ":"",t.type,t.values.length>0?" "+t.values.join(" "):"")}),t(e),e}static setData(t,e){let i=[];return e===e+""?i=X(e):Array.isArray(e)&&(i=e),t.parts=i,t}}class K{constructor(...t){u(!0,this,...t),this.__id||(this.__id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(new RegExp("[xy]","gm"),(function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})).toUpperCase()),this.view||(this.view=new Ht)}get id(){return this.__id||this.key}set id(t){this.__id=t}get key(){return this.__key||this.__id}set key(t){this.__key=t}static get Properties(){return["id","name"]}static get Tag(){return"g"}fromItem(t){return this.constructor.fromItem(t)}static fromItem(t){let e=t.constructor.Properties,i={};return e.forEach(e=>i[e]=t[e]),i}}const tt=t=>class extends t{get isBorder(){return!0}};class et extends K{get isBasicShape(){return!0}fromBounds(t){return this.constructor.fromBounds(t)}static fromBounds(t){}}class it extends et{constructor(...t){super({view:new Lt},...t),this.border&&(this.border=null)}get isBorderBasicShape(){return!0}}class st extends(F(it)){static get Tag(){return"line"}static get Properties(){return["x1","y1","x2","y2"]}}class rt extends it{static get Tag(){return"rect"}static get Properties(){return["x","y","width","height","rx","ry"]}static fromBounds(t){return{x:t.x,y:t.y,width:t.width,height:t.height}}}class nt extends(tt(rt)){}class ht extends it{static get Tag(){return"ellipse"}static get Properties(){return["cx","cy","rx","ry"]}static fromBounds(t){let e,i,s={};return t.width&&(s.rx=e=t.width/2),t.height&&(s.ry=i=t.height/2),isNaN(t.x)||isNaN(e)||(s.cx=t.x+e),isNaN(t.y)||isNaN(i)||(s.cy=t.y+i),s}}class at extends(tt(ht)){}class lt extends it{get ratio(){return 1}static get Tag(){return"circle"}static get Properties(){return["cx","cy","r"]}static fromBounds(t){let e,i,s={};return t.width&&(e=t.width/2,isNaN(t.x)||(s.cx=t.x+e)),t.height&&(i=t.height/2,isNaN(t.y)||(s.cy=t.y+i)),s.r=e>0&&i>0?Math.max(e,i):e>0?e:i>0?i:void 0,s}}class ot extends(tt(lt)){}class dt extends it{static get Tag(){return"path"}static get Properties(){return["d"]}}class ct extends(tt(dt)){}class ut extends it{static get Tag(){return"polygon"}static get Properties(){return["points"]}static fromBounds(e){t(e)}}class gt extends(tt(ut)){}class xt extends it{static get Tag(){return"polyline"}static get Properties(){return["points"]}}class mt extends(tt(xt)){}class yt extends et{constructor(...t){super({view:new Wt},...t)}static get Tag(){return"image"}static get Properties(){return["x","y","width","height","rx","ry"]}static fromBounds(t){return{x:t.x,y:t.y,width:t.width,height:t.height}}}class ft extends et{constructor(...t){super({view:new Rt,expandable:!1},...t),null==this.content&&(this.content="")}static get Properties(){return["x","y"]}static get Tag(){return"text"}get isText(){return!0}static fromItem(t){return{x:t.x,y:t.y}}static fromBounds(t){return{x:t.x,y:t.y}}}class wt extends K{constructor(...t){super({axis:P.vertical,mainAxisAlign:T.start,crossAxisAlign:T.start,textDirection:P.horizontal},...t)}}class pt extends wt{constructor(...t){super({children:[],view:new zt},...t)}}class bt extends wt{constructor(...t){super({child:void 0,view:new Ft},...t)}}class vt extends bt{constructor(...t){super({position:{outer:!0,align:T.center,direction:P.down,distance:10},view:new Vt},...t)}}class Et extends pt{constructor(...t){super({view:new Dt},...t)}}class Ct extends Et{constructor(...t){super({axis:P.horizontal,view:new qt},...t)}}class Nt extends Et{constructor(...t){super({axis:P.vertical,view:new $t},...t)}}class Mt extends bt{constructor(...t){super({mainAxisAlign:T.center,crossAxisAlign:T.center},...t)}}class It extends pt{constructor(...t){super({view:new Gt},...t)}}class _t extends pt{constructor(...t){super({view:new Xt},...t)}get isDef(){return!0}static get Tag(){return"marker"}static get Properties(){return["id","viewBox","markerWidth","markerHeight","refX","refY","orient"]}}class Ot extends pt{constructor(...t){super({view:new Xt},...t)}get isDef(){return!0}static get Tag(){return"symbol "}static get Properties(){return["id","viewBox","width","height","refX","refY","x","y","preserveAspectRatio"]}}class At extends pt{constructor(...t){super({view:new Xt},...t)}get isDef(){return!0}static get Properties(){return["id"]}}class St extends et{static get Tag(){return"use "}static get Properties(){return["href","x","y","width","height"]}}class jt extends pt{constructor(...t){super({bg:new rt({styleName:"bg"}),view:new Qt},...t)}get isArea(){return!0}}class Bt extends pt{constructor(...t){let e=new dt,i=new dt({style:{"stroke-width":20,opacity:0}});super({styleName:"edge",markerStart:void 0,view:new Ut,children:[i,e]},...t),this.path=e,this.outerPath=i}get isEdge(){return!0}}const Tt=Object.assign;function Pt(t,...e){let{item:i,renderObject:s,mdata:r}=t,{isolate:n}=i,h=t.getBounds(...e),a=i.axis===P.horizontal,{x:l=0,y:o=0,width:d=0,height:c=0,minWidth:u=0,minHeight:g=0,maxWidth:x,maxHeight:m}=a?W.createInverse(h):h,y=s.padding,f=0,w=0,p=n?0:l,b=n?0:o,v=r.minWidth||0,E=r.minHeight||0;return a&&([v,E]=[E,v],y=D.createInverse(y)),d>0&&(f=d-y.left-y.right,w=c-y.top-y.bottom),d=Math.max(d,u,v),c=Math.max(c,g,E),x>0&&d>x&&(d=x),m>0&&c>m&&(c=m),{x:l,y:o,axis:i.axis,isHorizontal:a,padding:y,crossAxisAlign:i.crossAxisAlign,mainAxisAlign:i.mainAxisAlign,sx:p,sy:b,tx:p,ty:b,width:d,height:c,minWidth:0,minHeight:0,totalWidth:0,totalHeight:0,contentHeight:w,contentWidth:f,boundsMinWidth:u,boundsMinHeight:g,lastMargin:null,flexCount:s.flexCount}}class Ht{measure(t){return this}layout(t,e){return this}}class kt extends Ht{ready(t){let{children:e,defs:i,extras:s}=t,r=e.length>0;return t.element||(this.create(t),i&&i.length>0&&i.forEach(t=>{t.item.view.ready(t).setBounds(t)}),s&&s.length>0&&s.forEach(t=>t.item.view.ready(t))),this.withCreate(t),r&&e.forEach(t=>t.item.view.ready(t)),this.afterCreate(t),this.measure(t),t.readyed=!0,this}doRender(t){let{view:e,rendered:i,layoutDisable:s,hidden:r,readyed:n,item:h,isEdge:a}=t;return i||(n||e.ready(t),t.rendered=!0,s&&!a||(e.setBounds(t),a&&!t.layoutStatus&&(t.rendered=!1))),this}doLayout(t,e){if(!t.item.isBasicShape)return this.layout(t,e),t.children.length>0&&t.children.forEach(t=>t.item.view.doLayout(t,t.ldata)),this}setBounds(t,e,i){let{item:s,mdata:r,ldata:n,extras:h}=t;return null==i&&(i=s.isolate),s.isBasicShape?i&&(r.change(e),n.change(e)):this.doLayout(t,e),this.doAdjust(t,i),this}doAdjust(t,e){let i,{bg:s,border:r,render:n,item:h,ldata:a,extras:l,children:o,isChart:d,isEdge:c,layoutDisable:g}=t;if(o.length>0&&o.forEach(t=>t.item.view.doAdjust(t)),t.item instanceof jt){let e=t.getChartNode(),{nodes:i,isLaneSet:s}=e;s&&i.forEach(t=>{t.item.view.doAdjust(t.context,!0)})}return this.withAdjust(t,e),i=e?{x:0,y:0,width:a.width,height:a.height}:{x:a.x,y:a.y,width:a.width,height:a.height},l&&l.length>0&&l.forEach(t=>t.item.view.setBounds(t,i,!0)),!e||h.isBasicShape||c||g||d||n.translate(t,a),c||(s&&s.item.view.setBounds(s,i,!0),r&&n.setProps(r.renderObject.element,h.border.constructor.Properties,u({},h.border.fromItem(h.border),h.border.fromBounds(i)))),this}withAdjust(t,e){return this}display(t){return this}reset(t){let{children:e,item:i,mdata:s,ldata:r}=t;return e.length>0&&e.forEach(t=>t.item.view.reset(t)),i.isText||(s.change({x:0,y:0,width:s.minWidth||0,height:s.minHeight||0}),r.change({x:0,y:0,width:0,height:0})),this}create(t){return t.render.createElement(t)}withCreate(t){return this}afterCreate(t){return this}translate(t,e,i,s){let{item:r,render:n,renderObject:h}=t,{bounds:a,ldata:l,mdata:o,element:d}=h,c={x:e,y:i};a.change(c);let g=Tt({},a,{width:o.width,height:o.height});if(r.isBasicShape){let t=u({},r.fromItem(r),r.fromBounds(g));n.setProps(d,r.constructor.Properties,t)}else n.translate(t,a,s);return l.change(c),o.change(c),this}resize(t,e,i){let{bounds:s,ldata:r}=t.renderObject,n=t.item.ratio;return e<5&&(e=5),i<5&&(i=5),isNaN(n)||(0==n&&(n=r.height>0?r.width/r.height:-1),n>0&&(1==n?e=i=Math.min(e,i):n>e/i?e=i*n:i=e/n)),s.width=e,s.height=i,this.reset(t),this.setBounds(t,s,!0),this}adjustEdge(t){let{edges:e}=t;return e&&e.length>0&&e.forEach(t=>t.item.view.layout(t).doAdjust(t)),this}toFront(t){let e=t.chartNode;if(e){if(t.parent.renderObject.element.appendChild(t.element),t.chartNode.isLane){let{nodes:t,isLaneSet:i}=e;i&&t.forEach(t=>{t.item.view.toFront(t.context)})}return this}}move(t,e,i){let{context:s,bounds:r,nodes:n,lanes:h,edges:a}=t,l=r.x+e,o=r.y+i;return s.view.translate(s,l,o),s.renderObject.selectBox&&s.renderObject.selectBox.translate(l,o),this.moveEnd(t),this}moveEnd(t,e,i){let{edges:s}=t;return s&&s.forEach(t=>t.context.item.view.layout(t.context).doAdjust(t.context)),this}changeStatus(t,e){}setStyle(t,...e){}}class Lt extends kt{measure(t){let{item:e,render:i,element:s,mdata:r}=t,n=0,h=0,a=0,l=0;if(e.isText){i.setProps(s,["x","y"],{x:void 0,y:void 0});let t=i.getBBox(s);a=t.width,l=t.height,n=t.x,h=t.y}return r.change({x:0,y:0,dx:n,dy:h,width:a,height:l,minWidth:a,minHeight:l}),e.isText&&this.isVertical(t)&&r.inverse(),this}withAdjust(t,e){let{item:i,render:s,element:r,ldata:n}=t;return s.setProps(r,i.constructor.Properties,u({},i.fromItem(i),i.boundsIsInvalid?null:i.fromBounds(n))),this}}class Rt extends Lt{withCreate(t,e){return t.render.renderText(t,e),this}getTextDirection(t){return t.item.textDirection||t.parent.item.textDirection}isVertical(t){return this.getTextDirection(t)===P.vertical}withAdjust(t){let{render:e,ldata:i}=t;return e.translateText(t,i),e.fixVerticalText(t),this}}class Wt extends Lt{withCreate(t){return t.render.renderImage(t),this}}class zt extends kt{}class Dt extends zt{hasChildren(t){return t.children.length>0}measureChildren(t,e){let i=e.children;i.forEach((e,s)=>{t.isLast=s==i.length-1,t.isFirst=0==s,this.measureChild(t,e,s)})}measure(t){let{children:e,mdata:i}=t,s=Pt(t),{isHorizontal:r,padding:n,width:h,height:a,boundsMinHeight:l,boundsMinWidth:o}=s;this.hasChildren(t)?this.measureChildren(s,t):(s.totalHeight=n.top+n.bottom,s.totalWidth=n.left+n.right);let d=s.totalWidth,c=s.totalHeight;return s.minWidth=Math.max(s.minWidth,o),s.minHeight=Math.max(s.minHeight,l),s.totalWidth=Math.max(h,s.totalWidth),s.totalHeight=Math.max(a,s.totalHeight),i.change({x:s.sx,y:s.sy,width:s.totalWidth,height:s.totalHeight,minWidth:s.minWidth,minHeight:s.minHeight,contentWidth:d,contentHeight:c}),r&&i.inverse(),this}measureChild(t,e){let{mdata:i,margin:s}=e.renderObject,{isHorizontal:r,isFirst:n,isLast:h,lastMargin:a,padding:l,width:o,totalWidth:d,totalHeight:c,minWidth:u,minHeight:g,contentWidth:x,contentHeight:m}=t;e.item.isText&&x>0&&(e.view.withCreate(e,{width:x,height:m}),e.view.measure(e)),r&&(s=$.createInverse(s),i.inverse());let{marginTop:y,marginLeft:f,marginRight:w,marginBottom:p}=e.renderObject.computeMargin=((t,e,i,s,r)=>({marginTop:Math.max(t.top,s?e.top:i.bottom),marginLeft:Math.max(e.left,t.left),marginRight:Math.max(e.right,t.right),marginBottom:r?Math.max(t.bottom,e.bottom):0}))(s,l,a,n,h);u=Math.max(u,i.minWidth+f+w),g+=i.minHeight+y,d=Math.max(d,u,o),c=y+i.height,t.lastMargin=s,h&&(g+=p,c+=p),t.totalWidth=Math.max(d,o,i.width+l.left+l.right),t.totalHeight+=c,t.minHeight=g,t.minWidth=u,r&&i.inverse()}layout(t,e){let{item:i,children:s,mdata:r,ldata:n}=t,h=Pt(t,e),{isHorizontal:a,flexCount:l,x:o,y:d,width:c,height:u}=h;a&&r.inverse();r.contentWidth;let g=u-r.contentHeight;return Tt(h,{width:c,height:u,emptySpaceHeight:g,cellHeight:l>0?g/l:0}),this.hasChildren(t)&&this.layoutChildren(h,t),i.isolate&&(n.change({x:o,y:d,width:c,height:u}),a&&n.inverse()),a&&r.inverse(),this}layoutChildren(t,e){let i=e.children;i.forEach((e,s)=>{t.isLast=s==i.length-1,t.isFirst=0==s,this.layoutChild(t,e,s)})}layoutChild(t,e){let{item:i,renderObject:s}=e,{mdata:r,ldata:n,margin:h}=s,{isHorizontal:a,flexCount:l,mainAxisAlign:o,crossAxisAlign:d,sx:c,ty:u,isFirst:g,isLast:x,padding:m,lastMargin:y,width:f,height:w,emptySpaceHeight:p,cellHeight:b}=t;a&&(h=$.createInverse(h),r.inverse());let{flex:v=0,expandable:E}=i,C=0,{marginTop:N,marginLeft:M,marginRight:I,marginBottom:_}=s.computeMargin,O=f-m.left-m.right,A=i.crossAxisAlign||d,S=t.tx=c,j=r.width;if(p>0&&(l>0?v>0&&(C=b*v):g&&(u+=o==T.center?p/2:o==T.end?p:0)),0!=E&&j<O&&(j=O),S=S-(r.x||0)-(r.dx||0),S+=A===T.center?(f-j)/2:A===T.end?f-j-I:M,u+=N-(r.dy||0),n.change({x:S,y:u,width:j,height:r.height+C}),t.lastMargin=h,u=u+n.height+(r.dy||0),x&&(u+=_),t.ty=u,e.item.isText&&e.view.isVertical(e)){let t=e.parent.ldata;n.y+=n.height/2+r.dx/2,n.y+=A===T.center?t.height/2+n.height/2:A===T.end?n.height:t.height,n.x=n.x-n.height/2-n.width/2}a&&(r.inverse(),n.inverse())}}class $t extends Dt{}class qt extends Dt{}class Ft extends $t{}class Vt extends Ft{layout(t,e){let{view:i,item:s,ldata:r,mdata:n,children:h}=t,{outer:a,align:l,direction:o,distance:d}=s.position,{x:c,y:u,width:g,height:x}=e,m=0,y=0;switch(o){case P.up:y=u-n.height-d;break;case P.left:m=c-n.width-d;break;case P.right:m=c+g+d;break;default:y=u+x+d}return o===P.left||o===P.right?y=l===T.start?u:l===T.end?u+x-n.height:u+(x-n.height)/2:m=l===T.start?c:l===T.end?c+g-n.width:c-(n.width-g)/2,h.forEach(t=>{let e=t.mdata;t.ldata.change({x:0-e.dx,y:0-e.dy,width:n.width,height:n.height})}),r.change({x:m,y:y,width:n.width,height:n.height}),this}}class Gt extends zt{layoutChild(t,e){let{item:i,renderObject:s}=e,{mdata:r,margin:n}=s,{sx:h,sy:a,width:l,height:o,totalWidth:d,totalHeight:c,totalMinHeight:u,totalMinWidth:g,padding:x}=t,m=!i.isText&&!i.fixSize,y=Math.max(n.top,x.top),f=Math.max(x.left,n.left),w=Math.max(x.right,n.right),p=Math.max(n.bottom,x.bottom),b=h-(r.x||0)+f,v=a-(r.y||0)+y,E=r.minWidth+f+w,C=r.minHeight+y+p;g=Math.max(g,E),u=Math.max(u,C),d=Math.max(d,g,l),c=Math.max(c,u,o);let N=d-x.left-x.right,M=c-x.top-x.bottom;m&&r.width<N&&(r.width=N),m&&r.height<M&&(r.height=M),t.totalHeight=Math.max(c,r.height+x.top+x.bottom),t.totalWidth=Math.max(d,r.width+x.left+x.right),t.totalMinWidth=g,t.totalMinHeight=u,s.ldata.change({x:b,y:v,width:r.width,height:r.height})}}class Zt extends Dt{}class Jt extends Zt{}class Ut extends kt{afterCreate(t){let{item:e,render:i,renderObject:s}=t;return s.path=t.builder.findIn(e.path,t),e.markerEnd&&i.setProps(s.path.renderObject.element,["marker-end","marker-start"],{"marker-end":`url(#${e.markerEnd})`}),s.outerPath=t.builder.findIn(e.outerPath,t),this}layout(t){let e,i,s,r,{item:n,renderObject:h,chartNode:a}=t,l=[],o=[],{source:d,target:c}=a||{};if(c&&(r=c.ldata.getCenter()),d&&(s=d.ldata.getCenter()),n.waypoints&&(l=l.concat(n.waypoints)),d&&d.rendered){let t=l[0]||r;if(t){let i=new V({x1:s.x,y1:s.y,x2:t.x,y2:t.y});e=V.intersectBounds(i,d.ldata)}}if(c&&c.rendered){let t=l[l.length-1]||s;if(t){let e=new V({x1:t.x,y1:t.y,x2:r.x,y2:r.y});i=V.intersectBounds(e,c.ldata)}}if(e&&e.length>0&&l.splice(0,0,e[0]),i&&i.length>0&&l.push(i[0]),l.length>1){let e=[];l.forEach((t,i)=>{o.push({x:t.x,y:t.y}),e.push(`${0==i?"M":"L"} ${t.x},${t.y}`)}),h.d=e.join(" "),h.points=l,t.layoutStatus=!0}else t.layoutStatus=!1;return this}withAdjust(t,e){let{item:i,render:s,renderObject:r,layoutStatus:n}=t,h=i.path.constructor.Properties,a={d:r.d},l=r.path.renderObject.element;r.points;return n?(s.setProps(l,h,a),s.setProps(r.outerPath.renderObject.element,h,a),this):this}resize(t,e,i){return this}}class Xt extends kt{create(t){t.render.createMarker(t)}}class Yt extends Xt{}class Qt extends Dt{hasChildren(t){return t.getChartNode().nodes.length>0}measureChildren(t,e){let i=e.getChartNode(),{nodes:s,isLaneSet:r}=i;r&&(e.renderObject.flexCount=t.flexCount=s.length,s.forEach((e,i)=>{t.isLast=i==e.length-1,t.isFirst=0==i,this.measureChild(t,e.context,i)}))}layoutChildren(t,e){let i=e.getChartNode(),{nodes:s,isLaneSet:r}=i;if(r){let r=i.context.ldata,{x:n,y:h}=r;e.renderObject.flexCount=t.flexCount=s.length,t.cellHeight=t.emptySpaceHeight/t.flexCount,t.axis===P.horizontal?(t.sx+=h,t.ty+=n):(t.sx+=n,t.ty+=h),s.forEach((e,i)=>{t.isLast=i==e.length-1,t.isFirst=0==i,this.layoutChild(t,e.context,i),e.context.item.view.setBounds(e.context,e.ldata)})}}}var Kt=[],te={};const ee=(t,e)=>{let i=t?t.split("#"):[];return i.length>1?{uri:i[0],name:i[1]}:{uri:e,name:i[0]}},ie={defineIconSet(t){Kt.push(t),null==te[t.uri]&&(te[t.uri]=new Map)},lookupIconSet:(t,e)=>Kt.find(i=>i.modelType==t&&(!e||i.uri===e)),lookup(t){let e,{name:i,owner:s,uri:r="basic"}=t;for(let t of Kt){if(r&&t.uri!==r||null==t.icons||t.icons.length<1||s&&s===t.owner)continue;let n=t.icons.get(i);if(n){if(n.extends){if(e=te[r].get(i),null==e){let t=this.lookup({name:n.extends,uri:r});e=u(!0,{},t,n),te[r].set(i,e)}}else e=n;break}}return e}},se={border:new nt,padding:D.all(10,5),edge:{isolate:!0,styleName:"edge"}};se.chart={defs:[new _t({id:"endArrow",markerWidth:"13",markerHeight:"13",refX:"10",refY:"6",orient:"auto",children:[new dt({boundsIsInvalid:!0,d:"M2,2 L2,11 L10,6 L2,2z"})]})]},se.node={expandable:!0,isolate:!0,styleName:"node",padding:se.padding},se.iconNode={create:t=>new Mt({border:se.border,bounds:{minWidth:40,minHeight:30},child:new ft({content:t.name})})},se.iconEdge={create:(t,e)=>new Bt({markerEnd:"endArrow"})};class re{constructor(t){this.item=t,this.context=null,this.model={}}get id(){return this.model.id||this.item.id}get mdata(){return this.context.mdata}get ldata(){return this.context.ldata}get rendered(){return!!this.context&&this.context.rendered}set owner(t){if(!(null==t||t instanceof ae||t instanceof oe))throw new Error(`owner ${t.id} is not pool,lane,or chart`);let e=this.__owner;if(e!==t){h(this,t,"__owner",this.isEdge?"edges":"nodes");let i=new CustomEvent("owner",{detail:{chartNode:this,owner:t,oldOwner:e}});this.__chart.trigger(i)}}get owner(){return this.__owner}set chart(t){h(this,t,"__chart",this.isEdge?"allEdges":"allNodes")}get chart(){return this.__chart}async createItem(){let{icon:t,iconURI:e}=this.model,i="edge"===this.type,s=e||this.chart.iconURI,r=ie.lookup(ee(t,s))||(i?se.iconEdge:se.iconNode),n=this.item=await r.create.call(r,this.model);return u(!0,n,i?se.edge:se.node,r.options),n.chartNode=this,n}async setIcon(t){this.model.icon=t,await this.createItem()}}class ne extends re{constructor(t){super(t),this.edges=[]}get isNode(){return!0}}class he extends re{constructor(t){super(t),this.__target=null,this.__source=null}get sourceRef(){return this.model.sourceRef}get targetRef(){return this.model.targetRef}set sourceRef(t){this.model.sourceRef=t}set targetRef(t){this.model.targetRef=t}get source(){return this.__source}set source(t){this.__source!=t&&(h(this,t,"__source","edges"),this.model.sourceRef=t?t.id:void 0,this.chart.trigger(new CustomEvent("model",{detail:{chartNode:this}})))}get target(){return this.__target}set target(t){this.__target!=t&&(h(this,t,"__target","edges"),this.model.targetRef=t?t.id:void 0,this.chart.trigger(new CustomEvent("model",{detail:{chartNode:this}})))}get isEdge(){return!0}}class ae extends ne{constructor(t){super(t),this.nodes=[],this.isLaneSet=!1}get isLane(){return!0}__changeHorizontal(t){this.item.axis=!0===t?P.horizontal:P.vertical;let e=this.item.children;e&&e.forEach(e=>{e.isArea?e.axis=!0===t?P.vertical:P.horizontal:e.textDirection=!0===t?P.vertical:P.horizontal}),this.isLaneSet&&this.nodes.forEach(e=>e.__changeHorizontal(t))}}class le extends ae{constructor(t){super(t)}get isPool(){return!0}setHorizontal(t){this.__changeHorizontal(t)}}class oe extends re{constructor(t){super(t),this.nodes=[],this.allNodes=[],this.allEdges=[],this.listeners=[],this.unJointedEdges=[]}on(t,e){return t&&e&&"function"==typeof e&&this.listeners.push([t,e]),this}off(t,e){if(t){let i;for(;this.listeners.length>0&&(i=this.listeners.findIndex(i=>i[0]===t&&(!e||i[1]===e)),!(i<0));)this.listeners.splice(i,1)}return this}offAll(){return this.listeners=[],this}trigger(t){if(null!=t)for(let e of this.listeners)e[0]===t.type&&e[1](t)}get iconURI(){return this.model.iconURI}get isChart(){return!0}findNode(t){return this.allNodes.find(e=>e.id===t)}findEdge(t){return this.allEdges.find(e=>e.id===t)}}class de{async createChart(t){let e=u(!0,{},se.chart),i=new oe(new pt(e));return i.model=t,i.chartBuilder=this,i.item.chartNode=i,i.on("create",t=>this.__handleCreateEvent(t)),i.on("remove",t=>this.__handleRemoveEvent(t)),i.on("owner",t=>this.__handleOwnerEvent(t)),i}async createChartNode(t,e,i){let s="edge"===e?new he:"lane"===e?new ae:"pool"===e?new le:new ne;s.model=i,s.chart=t,s.type=e,s.isLane&&(s.isLaneSet=!!i.lanes),await s.createItem();let r=new CustomEvent("create",{detail:{chartNode:s}});return t.trigger(r),s}__handleCreateEvent(t){}__handleOwnerEvent(t){if(null==t)return;let{chartNode:e,owner:i,oldOwner:s}=t.detail;e.chart&&(e.isNode?this.jointRemains(e):e.isEdge&&this.joint(e))}__handleRemoveEvent(e){t(e)}async build(t={}){let e=await this.createChart(t);return await this.buildElments(e,t),e}async buildElments(t,e){}jointRemains(t){let e=t.id;t.chart.unJointedEdges=t.chart.unJointedEdges.filter(t=>(t.sourceRef==e||t.targetRef==e)&&!this.joint(t))}joint(t){let{target:e,source:i,sourceRef:s,targetRef:r,id:n,chart:h}=t,a=h.allNodes;return!i&&s&&(i=a.find(t=>t.id===s)),!e&&r&&(e=a.find(t=>t.id===r)),i&&e?(t.source=i,t.target=e,!0):(h.unJointedEdges.findIndex(t=>t.id===n)<0&&h.unJointedEdges.push(t),!1)}disJoint(t){let{target:e,source:i,chart:s}=t;i&&e&&(t.source=null,t.target=null,s.unJointedEdges.push(t))}}class ce extends de{async buildElments(t,e){let i=e.elements.slice(0);for(;i.length>0;){let e=i.shift();e&&await this.__buildElement(t,i,e[0],e[1])}}async __buildElement(t,e,i,s,r){let n=await this.createChartNode(t,i,s);if(n.owner=r||t,n.isEdge)return n;if(n.isLane){let i,r,h,a,l,{nodes:o,lanes:d}=s,c=(n.isLaneSet=!!d&&d.length>0)?d:o;if(null==c||c.length<=0)return n;for(i in c)r=c[i],h=e.findIndex(t=>t[1].id===r),h>-1?(a=e[h],e.splice(h,1),l=await this.__buildElement(t,e,a[0],a[1],n)):l=t.allNodes.find(t=>t.id===r),l&&(l.owner=n,l.isolateOwner=n.isolateOwner||n)}return n.isPool&&n.setHorizontal(!0===s.isHorizontal),n}}const ue=Object.assign,ge=["none","#fff","#ffffff"],xe={node:{background:{"stroke-width":0,opacity:0},border:{stroke:"#111","stroke-width":1,fill:"#fff","fill-opacity":.8,"stroke-opacity":.8},title:{"font-size":16}},edge:{border:{stroke:"#111","stroke-width":1}}};class me{constructor(t){ue(this,{item:t,children:[],extras:[],defs:[],parent:null,__rendered:!1,__visible:!1})}get key(){return this.item.key}get view(){return this.item.view}get layoutDisable(){return this.item.layoutDisable}get rendered(){return this.__rendered}set rendered(t){this.__rendered=1==t}get element(){return this.renderObject.element}get ldata(){return this.renderObject.ldata}get mdata(){return this.renderObject.mdata}get bounds(){return this.renderObject.bounds}get chartNode(){return this.item.chartNode}get isEdge(){let t=this.chartNode;return!!t&&t.isEdge}get model(){return this.chartNode?this.chartNode.model:null}getChartNode(){return this.item.chartNode||this.parent&&this.parent.getChartNode()}snapshotBounds(t,e){if(!this.isChartNode||this.isEdge)return;let i=this.ldata,s={context:this};if(e||(s.edges=e=[]),s.bounds={x:i.x,y:i.y,width:i.width,height:i.height},t){let{areas:i,nodes:r,edges:n}=this;i&&i.length>0?(s.areas=[],i.forEach(i=>s.areas.push(i.snapshotBounds(t,e)))):r&&r.length>0&&(s.nodes=[],r.forEach(i=>s.nodes.push(i.snapshotBounds(t,e)))),n&&n.length>0&&n.forEach(t=>e.push({context:t}))}return s}getBounds(...t){return u(!0,{x:0,y:0},this.item.bounds,this.model?this.model.bounds:null,...t)}getElementStyle(){let t=this.getChartNode(),e=this.item;return u(!0,{},t&&t.isEdge?t.chart.style.edge.border:e.isTitle?t.chart.style.node.title:e.isContent?t.chart.style.node.context:null,e.style)}getBorderStyle(){let t=this.getChartNode(),e=this.item,i=u(!0,{},t.chart.style.node.border,t.style?t.style.node:null),s=u({},e.style);return i.fill&&e.style&&e.style.fill&&(i.fill=i.fill.toLowerCase(),ge.includes(i.fill)||delete s.fill),(e.style||t.model.style)&&u(i,s,t.model.style),i}getBGStyle(){let t=this.getChartNode(),e=this.item;return u(!0,{},t.chart.style.node.background,e.style)}}class ye{constructor(t,e){ue(this,{context:t,element:e,ldata:new W,mdata:new W,bounds:new W}),this.init()}init(){let t=this.context.item;t&&(this.padding=new D(t.padding),this.margin=new $(t.margin),this.bounds.change(t.bounds),this.flex=t.flex)}get element(){return this.__element}set element(t){this.__element=t,t&&(t.context=this.context)}}class fe{constructor(t){this.render=t}buildItemContext(t,e,i,s){if(null==t||!(t instanceof K))return console.warn(t),void console.warn((t?`object ${t.key}, not Item instance.`:"item is null, ")+"ignored.");let r=this.findInNodeList(t,i);if(!r){r=this.createItemContext(t,e,i),r.renderObject.flexCount=0,this.buildItem(t,r,r.children)}return r}createItemContext(t,e,i){var s=new me(t);return s.builder=this,s.render=this.render,s.renderObject=this.render.createRenderObject(s),s.parent=e,i&&i.push(s),s}buildItem(t,e,i){let{defaultDefs:s,defs:r,title:n,bg:h,border:a,extras:l}=t;return t.children?t.children.forEach(t=>this.buildItemChild(t,e,i)):t.child&&this.buildItemChild(t.child,e,i),s&&s.forEach(t=>this.buildItemChild(t,e,e.defs)),r&&r.forEach(t=>this.buildItemChild(t,e,e.defs)),n&&(e.title=this.findIn(n,e)),a&&(e.border=this.buildItemContext(a,e)),h&&(e.bg=this.buildItemContext(h,e)),l&&l.length>0&&l.forEach(t=>this.buildItemContext(t,e,e.extras)),e}buildItemChild(t,e,i){this.buildItemContext(t,e,i),t.flex>0&&(e.renderObject.flexCount+=t.flex)}buildChart(t,e){return t.context=this.buildItemContext(t.item,e),t.style=u(!0,{},xe,t.model.style),t}buildNode(t,e){return t.context=this.buildItemContext(t.item,e),t}buildEdge(){}addChartNode(){}removeChartNode(){}replaceChartNode(t,e){}findIn(t,e,i){let s=t===t+""?t:t.key;return r(e,t=>t.key===s)}findInNodeList(t,e){let i=t===t+""?t:t.key;return e?e.find(t=>t.key===i):void 0}setChartStyle(t){}setNodeStyle(t){t.style=u(!0,{},t.chart.style.node,t.item.style,t.model.style)}setEdgeStyle(t){}}class we{constructor(t){this.canvas=t}createRenderObject(t){return new ye(t)}getProp(t,e){}setProp(t,e,i){}translate(t,e,i){}clean(){}}class pe extends we{get svg(){return this.canvas.canvasElement}get defs(){let t=this.canvas.defs;return t||(t=this.canvas.defs=function(t,e){let i,s,r,n,h;if(1==arguments.length&&(e=t,t=document),null!=e&&e===e+""){if(9==t.nodeType||11==t.nodeType)return t.querySelector(e);if(e=e.trim(),n=c(e),1==n.length){if(h=e.charAt(0),"#"===h)return document.getElementById(e.substr(1));if("."===h)return t.getElementsByClassName(e.substr(1))[0]}try{d(s=i=t.id)&&(t.id=s="___q_id___"),r=t.querySelector("#"+s+" "+e)}catch(t){}finally{d(i)&&t.removeAttribute("id")}return r}}(this.svg,"defs"),t||(t=this.canvas.defs=o("defs")[0],this.svg.insertBefore(t,this.svg.firstChild))),t}cloneMatrix(t){let e=this.svg.createSVGMatrix();if(t){let i=t;e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e.e=i.e,e.f=i.f}return e}clean(t){t.isRoot||t.renderObject.element.remove()}createElement(t){let{bg:e,border:i,item:s,parent:r,isolateParent:n,renderObject:h}=t;return h.element||(h.element=this.create({tag:s.constructor.Tag||"g",styleName:s.styleName,style:t.getElementStyle()}),r.renderObject.element.appendChild(h.element),i&&this.createBorder(i),e&&this.createBG(e)),h.element}createBG(t){let{item:e,parent:i,renderObject:s}=t;s.element=this.create({tag:e.constructor.Tag||"g",styleName:e.styleName,style:t.getBGStyle()});let r=i.renderObject.element;r.insertBefore(s.element,r.firstElementChild)}createBorder(t){let{item:e,renderObject:i,parent:s}=t;i.element=this.create({tag:e.constructor.Tag||"g",styleName:e.styleName,props:e.constructor.Properties,values:e,style:t.getBorderStyle()});let r=s.renderObject.element;r.insertBefore(i.element,r.firstElementChild)}createMarker(t){let e=t.item,i=t.renderObject.element=this.create({tag:e.constructor.Tag||"marker",styleName:e.styleName,props:e.constructor.Properties,values:e,style:e.style});return this.defs.appendChild(i),i}createUse(t,e,i){t.item;let s=t.renderObject[e]=this.create({tag:"use",props:["id","x","y","width","height"],values:{width:24,height:24}});return s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+i),t.renderObject.element.appendChild(s),s}create({tag:t,styleName:e,isolateStyle:i,style:s,props:r,values:n}){let h=o(t)[0];if(e&&c(e).forEach(t=>h.classList.add(t)),i||s){let t=u({},i,s),e="";Object.keys(t).forEach(i=>e+=`${i}:${t[i]};`),""!==e&&(h.style.cssText=e)}return r&&n&&this.setProps(h,r,n),h}setStyle(t,e,i){let s=t.renderObject.element,r=s.style;r[e]=i,""===r.cssText&&s.removeAttribute("style")}getStyle(t,e){let i=t.renderObject.element.style[e];return null==i||""===i?null:i}getStyleValue(t,e){return getComputedStyle(t)[e]}setProp(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}getProp(t,e){return t.getAttribute(e)}setProps(t,e,i){for(let s of e){let e=i[s];void 0===e||""===e||(null===e?t.removeAttribute(s):t.setAttribute(s,e))}}renderShadowText(t,e){this.__renderText(t,t.renderObject.shadowElement,e)}renderText(t,e){this.__renderText(t,t.renderObject.element,e)}renderImage(t){let e=t.item.url;t.renderObject.element.href.baseVal=e}fixVerticalText(t){let{view:e,ldata:i,element:s}=t;if(e.isVertical(t)){let t=i.y-i.height/2,e=i.x+i.width/2;s.style["transform-origin"]=`${e}px ${t}px`,s.style.transform="rotate(-90deg)"}}fix(t){}translateTextElement(t,e=0,i=0){t.setAttribute("x",e),t.setAttribute("y",i),Array.from(t.children).forEach(t=>{"tspan"===t.localName&&t.setAttribute("x",e)})}translateText(t,e){this.translateTextElement(t.element,e.x,e.y)}translateElement(t,e,i,s){if(!s){let e=t.transform.baseVal;s=0===e.numberOfItems?this.svg.createSVGMatrix():e.getItem(0).matrix}let r=this.cloneMatrix(s);r.e=e,r.f=i,t.setAttribute("transform",(t=>{let{a:e,b:i,c:s,d:r,e:n,f:h}=t;return`matrix(${e},${i},${s},${r},${n},${h})`})(r))}translate(t,e,i){this.translateElement(t.element,e.x,e.y,i)}__renderText(t,e,s){let r=t.item.content,n=i(h=r)?[]:h.split(g);var h;if(e.textContent="",s){let{width:t,height:i}=s;renderSections(e,n,t,i)}else if(n.length>1){let t,i=0,s=0,r=5;n.forEach((n,h)=>{let a=o("tspan")[0];a.textContent=n,a.setAttribute("x",0),a.setAttribute("dy",i),e.appendChild(a),t=e.getBBox(),i=t.height-s+r,s=t.height+r})}else e.textContent=r}getBBox(t){return t.getBBox()}changeBorderStyle(t){}changeBGStyle(t){}changeTextColor(t){}changeTextStyle(t){}}class be{constructor(t){this.element=t,this.init(),this.builder=new fe(this.render),this.rootContext=this.builder.buildItemContext(new pt),this.rootContext.renderObject.element=this.canvasElement,this.contentLayer=this.createLayer(this.rootContext)}init(){}drawChart(t){if(null==t)return;this.clear(),this.chart=t,this.builder.buildChart(this.chart,this.contentLayer),t.context.view.doRender(t.context);let e=t.nodes.slice(0);for(;e.length>0;){let t=e.shift();t&&this.drawNode(t)}t.allEdges.forEach(t=>this.drawEdge(t))}createLayer(t){let e=this.builder.buildItemContext(new pt,t);return e.view.doRender(e),e}drawEdge(t){this.builder.buildNode(t,this.chart.context);let e=t.context;e.view.doRender(e)}drawNode(t){if(this.builder.buildNode(t,this.chart.context),t.isLane&&t.nodes.length>0){let e,i,s=t.nodes;for(e in s)i=s[e],i.rendered||this.drawNode(i)}let e=t.context;e.view.doRender(e),t.isPool&&e.view.toFront(e)}clear(){this.chart=null}}class ve extends be{init(){this.canvasElement=o('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs></defs></svg>')[0],this.element.appendChild(this.canvasElement),this.render=new pe(this)}setChartStyle(t){}setNodeStyle(t){}setEdgeStyle(t){}move(){}resize(){}onRender(){}onShow(){}onHide(){}onRemove(){}onToggleOff(){}onToggleOn(){}onResize(){}onTranslate(){}onMoveStart(){}onMoveing(){}onMoveEnd(){}onStyle(){}on(){}off(){}}export{T as Align,jt as Area,Qt as AreaView,et as BasicShape,Lt as BasicShapeView,it as BorderBasicShape,W as Bounds,be as Canvas,Mt as Center,oe as Chart,de as ChartBuilder,he as ChartEdge,re as ChartItem,ae as ChartLane,ne as ChartNode,le as ChartPool,Jt as ChartView,lt as Circle,ot as CircleBorder,Nt as Column,$t as ColumnView,wt as Compose,bt as Container,Ft as ContainerView,fe as ContextBuilder,z as Corner,P as Direction,Bt as Edge,Ut as EdgeView,ht as Ellipse,at as EllipseBorder,H as Fit,Et as Flex,Dt as FlexView,ie as IconFactory,yt as Image,Wt as ImageView,K as Item,kt as ItemView,pt as Layer,zt as LayerView,st as Line,V as LineData,$ as Margin,_t as Marker,Xt as MarkerView,k as Matrix,D as Padding,dt as Path,ct as PathBorder,Q as PathData,Zt as PlaneView,q as Point,ut as Polygon,gt as PolygonBorder,xt as Polyline,mt as PolylineBorder,vt as Positioned,Vt as PositionedView,rt as Rect,nt as RectBorder,we as Render,ye as RenderObject,Ct as Row,qt as RowView,ve as SVGCanvas,pe as SVGRender,U as Segment,At as ShapeMarker,ce as SimpleChartBuilder,L as Size,It as Stack,Gt as StackView,Ot as Symb,St as SymbolRef,Yt as SymbolView,ft as Text,Rt as TextView,Ht as View,F as asLine,ee as getIconParam};
